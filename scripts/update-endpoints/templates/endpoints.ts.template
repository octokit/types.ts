// DO NOT EDIT THIS FILE
import { paths } from "@octokit/openapi-types";
import { OctokitResponse } from "../OctokitResponse";
import { RequestHeaders } from "../RequestHeaders";
import { RequestRequestOptions } from "../RequestRequestOptions";

// https://stackoverflow.com/a/50375286/206879
type UnionToIntersection<U> = (U extends any ? (k: U) => void : never) extends (
  k: infer I
) => void
  ? I
  : never;

type ExtractParameters<T> = "parameters" extends keyof T
  ? UnionToIntersection<
      {
        [K in keyof T["parameters"]]: T["parameters"][K];
      }[keyof T["parameters"]]
    >
  : {};
type ExtractRequestBody<T> = "requestBody" extends keyof T
  ? "application/json" extends keyof T["requestBody"]
    ? T["requestBody"]["application/json"]
    : {
        data: {
          [K in keyof T["requestBody"]]: T["requestBody"][K];
        }[keyof T["requestBody"]];
      }
  : {};
type ToOctokitParameters<T> = ExtractParameters<T> & ExtractRequestBody<T>;

type RequiredPreview<T> = T extends string
  ? {
      mediaType: {
        previews: [T, ...string[]];
      };
    }
  : {};

type Operation<
  Url extends keyof paths,
  Method extends keyof paths[Url],
  preview = unknown
> = {
  parameters: ToOctokitParameters<paths[Url][Method]> &
    RequiredPreview<preview>;
  request: {
    method: Method extends keyof MethodsMap ? MethodsMap[Method] : never;
    url: Url;
    headers: RequestHeaders;
    request: RequestRequestOptions;
  };
  response: ExtractFirstSuccessResponse<paths[Url][Method]>;
};

type MethodsMap = {
  delete: "DELETE";
  get: "GET";
  patch: "PATCH";
  post: "POST";
  put: "PUT";
};
type SuccessStatusesMap = {
  "200": 200;
  "201": 201;
  "204": 204;
};
type RedirectStatusesMap = {
  "301": 301;
  "302": 302;
};

type DataType<T> = "application/json" extends keyof T
  ? T["application/json"]
  : // SCIM endpoints
  "application/scim+json" extends keyof T
  ? T["application/scim+json"]
  : unknown;
type ExtractFirstSuccessResponse<R> = "responses" extends keyof R
  ? FirstSuccessResponse<R["responses"]>
  : unknown;
type FirstSuccessResponse<
  R,
  S extends keyof R = keyof R
> = S extends keyof SuccessStatusesMap
  ? R[S] extends never
    ? Omit<OctokitResponse<unknown, SuccessStatusesMap[S]>, "data">
    : OctokitResponse<DataType<R[S]>, SuccessStatusesMap[S]>
  : S extends keyof RedirectStatusesMap
  ? OctokitResponse<unknown, RedirectStatusesMap[S]>
  : never;

export interface Endpoints {
  {{#each endpointsByRoute}}
  /**
   * @see {{documentationUrl}}
   {{#deprecated}}
   * @deprecated {{{.}}}
   {{/deprecated}}
   */
  "{{@key}}": Operation<
    "{{url}}",
    "{{method}}"
    {{#requiredPreview}}, "{{.}}"{{/requiredPreview}}
  >,
  {{/each}}
}